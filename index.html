<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulario do cliente</title>

<style>
*{box-sizing:border-box;}
body{
 margin:0;font-family:Arial;background:black;color:white;
 min-height:100vh;display:flex;justify-content:center;align-items:center;padding:15px;
}
.box{
 width:100%;max-width:420px;background:#0d0d0d;padding:20px;
 border-radius:15px;box-shadow:0 0 20px #ff000055;text-align:center;
}
h1{color:red;}
label{text-align:left;display:block;margin-top:12px;}
input{
 width:100%;padding:12px;margin-top:6px;
 border-radius:8px;border:none;font-size:16px;
}
button{
 margin-top:18px;width:100%;padding:14px;
 background:red;color:white;border:none;
 border-radius:10px;font-size:18px;
 cursor:pointer;
}
button:disabled{
 opacity:.5;
 cursor:not-allowed;
}
.error{color:red;margin-top:8px;display:none;font-weight:bold;}
#segundaParte,#adminParte{display:none;}
</style>
</head>

<body>

<div class="box" id="formParte">
<h1>Formulario do cliente</h1>

<label>Nome</label>
<input id="nome">

<label>Nick do Discord</label>
<input id="discord" placeholder="Ex: usuario#1234">
<div class="error" id="erroDiscord">Discord inválido</div>

<label>Seu personagem de Stranger Things</label>
<input id="personagem">
<div class="error" id="erroPersonagem">Personagem já utilizado</div>

<label>Idade</label>
<input type="number" id="idade">
<div class="error" id="erroIdade">Menores de 10 anos não podem</div>

<button id="enviarBtn" onclick="enviar()" disabled>Enviar</button>
</div>

<div class="box" id="segundaParte">
<h1 id="bemVindo"></h1>
<p>Confirmar formulario</p>
<button onclick="confirmar()">Confirmar formulario</button>
</div>

<div class="box" id="adminParte">
<h1>Senha:</h1>
<input type="password" id="senha">
<button onclick="verificarSenha()">Confirmar</button>
<div class="error" id="erroSenha"></div>
</div>

<script>
const inputs = document.querySelectorAll("input");
const enviarBtn = document.getElementById("enviarBtn");

function discordValido(n){
 return /^[a-zA-Z0-9_.]{2,32}(#\d{4})?$/.test(n);
}

function personagemNormalizado(p){
 return p.trim().toLowerCase();
}

function personagemUsado(p){
 const usados = JSON.parse(localStorage.getItem("personagensUsados")) || [];
 return usados.includes(personagemNormalizado(p));
}

function verificar(){
 if(nome.value.trim().toLowerCase() === "reset!"){
   formParte.style.display="none";
   adminParte.style.display="block";
   return;
 }

 const discordOk = discordValido(discord.value.trim());
 const idadeOk = idade.value && idade.value >= 10;
 const personagemOk = personagem.value && !personagemUsado(personagem.value);

 erroDiscord.style.display = discord.value && !discordOk ? "block" : "none";
 erroIdade.style.display = idade.value && !idadeOk ? "block" : "none";
 erroPersonagem.style.display = personagem.value && !personagemOk ? "block" : "none";

 enviarBtn.disabled = !(nome.value && discordOk && idadeOk && personagemOk);
}

inputs.forEach(i => i.addEventListener("input", verificar));

function enviar(){
 const usados = JSON.parse(localStorage.getItem("personagensUsados")) || [];
 usados.push(personagemNormalizado(personagem.value));
 localStorage.setItem("personagensUsados", JSON.stringify(usados));

 formParte.style.display="none";
 segundaParte.style.display="block";
 bemVindo.innerText = `Olá ${nome.value}, seja bem-vindo`;
}

function confirmar(){
 const corpo =
`Formulario do cliente

Nome: ${nome.value}
Discord: ${discord.value}
Personagem: ${personagem.value}
Idade: ${idade.value}`;

 const gmailLink =
 "https://mail.google.com/mail/?view=cm&fs=1" +
 "&to=mi.micael1405@gmail.com" +
 "&su=Formulario%20do%20Discord" +
 "&body=" + encodeURIComponent(corpo);

 window.open(gmailLink, "_blank");
}

let tentativas = 0;
function verificarSenha(){
 if(senha.value === "ADM123"){
   localStorage.removeItem("personagensUsados");
   adminParte.innerHTML = "<h1>Resetado</h1><p>Lista apagada.</p>";
 } else {
   tentativas++;
   erroSenha.style.display="block";
   erroSenha.innerText="Senha incorreta";
   senha.value="";
   if(tentativas >= 3){
     adminParte.innerHTML="<h1>Acesso bloqueado</h1>";
   }
 }
}
</script>

</body>
</html>
