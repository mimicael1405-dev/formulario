<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Formulario Stranger Things</title>

<style>
*{box-sizing:border-box;}
body{
 margin:0;
 font-family:Arial;
 background:black;
 color:white;
 min-height:100vh;
 display:flex;
 justify-content:center;
 align-items:center;
 padding:15px;
}

.box{
 width:100%;
 max-width:440px;
 background:linear-gradient(145deg,#0a0a0a,#111);
 padding:22px;
 border-radius:18px;
 box-shadow:0 0 25px #ff000070;
 text-align:center;
 display:none;
}

#formParte{display:block;}

h1{color:red;text-shadow:0 0 10px red;}
label{text-align:left;display:block;margin-top:12px;}
input{
 width:100%;
 padding:12px;
 margin-top:6px;
 border-radius:8px;
 border:none;
 font-size:16px;
}

button{
 margin-top:15px;
 width:100%;
 padding:14px;
 background:red;
 color:white;
 border:none;
 border-radius:10px;
 font-size:18px;
 cursor:pointer;
 transition:.3s;
}

button:hover{
 transform:scale(1.05);
 box-shadow:0 0 15px red;
}

.error{
 color:red;
 margin-top:6px;
 display:none;
 font-weight:bold;
}

#enviarBtn{display:none;}

.linha{
 display:flex;
 gap:10px;
}

.linha button{width:50%;}

.contador{
 margin:10px 0;
 padding:10px;
 border-radius:12px;
 background:#000;
 border:1px solid #ff000060;
 font-size:18px;
 color:#00ff88;
}

.lista{
 text-align:left;
 margin-top:10px;
 background:#050505;
 padding:12px;
 border-radius:12px;
 border:1px solid #ff000040;
 max-height:260px;
 overflow-y:auto;
}
.lista div{
 padding:6px;
 border-bottom:1px solid #222;
}
.lista div:last-child{border-bottom:none;}
</style>
</head>

<body>

<!-- FORM -->
<div class="box" id="formParte">
<h1>Formulario do cliente</h1>

<label>Nome</label>
<input id="nome">

<label>Nick do Discord</label>
<input id="discord">
<div class="error" id="erroDiscord">Apenas letras, n√∫meros e _</div>

<label>Personagem</label>
<input id="personagem">
<div class="error" id="erroPersonagem">Personagem j√° usado</div>

<label>Idade</label>
<input type="number" id="idade">
<div class="error" id="erroIdade">Menores de 10 n√£o podem</div>

<button id="enviarBtn" onclick="enviar()">Enviar</button>
<button onclick="abrirLoginAdmin()">√Årea Admin</button>
</div>

<!-- CONFIRMA -->
<div class="box" id="segundaParte">
<h1 id="bemVindo"></h1>
<p>Confirmar formul√°rio?</p>
<button onclick="confirmar()">Confirmar e enviar</button>
</div>

<!-- LOGIN ADMIN -->
<div class="box" id="senhaParte">
<h1>√Årea Admin</h1>
<input type="password" id="senha" placeholder="Senha admin">
<button onclick="verificarSenha()">Entrar</button>
<div class="error" id="erroSenha"></div>
</div>

<!-- RESET -->
<div class="box" id="resetSenha">
<h1>Resetar senha?</h1>
<div class="linha">
<button onclick="mostrarReset()">Resetar</button>
<button onclick="naoResetar()">N√£o</button>
</div>

<div id="areaReset" style="display:none;">
<input id="novaSenha" placeholder="Nova senha">
<button onclick="salvarNovaSenha()">Salvar</button>
</div>
</div>

<!-- ADMIN -->
<div class="box" id="adminParte">
<h1>Painel Admin</h1>
<div class="contador" id="contadorPessoas"></div>
<div class="lista" id="listaNomes"></div>
<button onclick="sair()">Sair</button>
</div>

<script>
let tentativas = 0;

if(!localStorage.getItem("senhaAdmin")){
 localStorage.setItem("senhaAdmin","STH");
}

function discordValido(n){
 return /^[A-Za-z0-9_]{2,32}$/.test(n);
}

function personagemUsado(p){
 let u = JSON.parse(localStorage.getItem("personagensUsados")) || [];
 return u.includes(p.toLowerCase());
}

function verificar(){
 let discordOk = discordValido(discord.value.trim());
 let personagemOk = personagem.value && !personagemUsado(personagem.value);

 erroDiscord.style.display = discord.value && !discordOk ? "block" : "none";
 erroPersonagem.style.display = personagem.value && !personagemOk ? "block" : "none";

 if(idade.value && idade.value < 10){
   erroIdade.style.display="block";
   enviarBtn.style.display="none";
   return;
 }else erroIdade.style.display="none";

 if(nome.value && idade.value && discordOk && personagemOk)
   enviarBtn.style.display="block";
 else enviarBtn.style.display="none";
}

document.querySelectorAll("input").forEach(i=>{
 i.addEventListener("input", verificar);
});

function enviar(){
 let usados = JSON.parse(localStorage.getItem("personagensUsados")) || [];
 usados.push(personagem.value.toLowerCase());
 localStorage.setItem("personagensUsados", JSON.stringify(usados));

 bemVindo.innerText = "üî• Bem-vindo, " + nome.value;

 formParte.style.display="none";
 segundaParte.style.display="block";
}

function confirmar(){
 let corpo =
`Formulario do cliente

Nome: ${nome.value}
Discord: ${discord.value}
Personagem: ${personagem.value}
Idade: ${idade.value}`;

 let gmailLink =
 "https://mail.google.com/mail/?view=cm&fs=1"+
 "&to=mi.micael1405@gmail.com"+
 "&su=Formulario%20Stranger%20Things"+
 "&body="+encodeURIComponent(corpo);

 window.open(gmailLink,"_blank");

 location.reload();
}

function abrirLoginAdmin(){
 formParte.style.display="none";
 senhaParte.style.display="block";
}

function verificarSenha(){
 let senhaSalva = localStorage.getItem("senhaAdmin");
 if(senha.value === senhaSalva){
   abrirAdmin();
 }else{
   tentativas++;
   erroSenha.style.display="block";
   erroSenha.innerText="Senha incorreta";

   if(tentativas >= 3){
     senhaParte.style.display="none";
     resetSenha.style.display="block";
   }
 }
}

function mostrarReset(){
 areaReset.style.display="block";
}

function naoResetar(){
 resetSenha.style.display="none";
 abrirAdmin();
}

function salvarNovaSenha(){
 localStorage.setItem("senhaAdmin", novaSenha.value);
 abrirAdmin();
}

function abrirAdmin(){
 senhaParte.style.display="none";
 resetSenha.style.display="none";
 adminParte.style.display="block";
 mostrarLista();
}

function mostrarLista(){
 let usados = JSON.parse(localStorage.getItem("personagensUsados")) || [];
 contadorPessoas.innerText = "üë• Total cadastrados: " + usados.length;
 listaNomes.innerHTML = usados.length
 ? usados.map((n,i)=>`<div>${i+1}. ${n}</div>`).join("")
 : "<i>Nenhum registrado</i>";
}

function sair(){
 location.reload();
}
</script>

</body>
</html>
